{"version":3,"sources":["src\\index.js"],"names":["ASSETS_PATH","DEFAULT","IMAGE_SD","IMAGE_HD","COLOR_WHITE","COLOR_BLACK","Utils","windowRatio","window","innerWidth","innerHeight","console","log","Renderer","_Renderer","self","paramsDefault","webGLRenderer","antialias","alpha","clearColor","canvasId","params","init","keepCurrentAntialias","THREE","WebGLRenderer","setClearColor","setPixelRatio","devicePixelRatio","domElement","id","renderView","refresh","setParamAntialias","isAntialiasNotChanging","canvasElement","document","getElementById","body","removeChild","Scene","activeOrbitControls","SceneShadow","activeWebGLRendererShadowMap","previousAntialias","view","appendChild","updateSize","setSize","gui","reset","add","folderRenderer","addFolder","listen","onChange","Camera","_Camera","perspectiveCamera","positionX","positionY","positionZ","fov","near","far","PerspectiveCamera","position","set","updateAspect","aspect","updateProjectionMatrix","updateLookAt","target","lookAt","colors","_default","folderCamera","name","Skymap","_Skymap","imgDef","imgDefPrevious","undefined","cubeTextureLoader","positionTag","positions","filename","sd","hd","setParamImgDef","setSceneBgCubeTexture","_scene","doesRefreshTextureNecessary","background","getCubeTextureLoader","disableRefreshTexture","CubeTextureLoader","setPath","load","getFilenames","filenames","i","length","push","getFilename","replace","scene","folderSkymap","Cloud","_Cloud","visible","material","wireframe","transparent","color","bumpScale","opacity","alphaMap","bumpMap","geometry","radius","widthSegments","heightSegments","animate","enabled","rotationsYPerSecond","MeshPhongMaterial","setMaterialTextures","SphereGeometry","cloudMesh","Mesh","delta","rotation","y","Math","PI","TextureLoader","setHex","resetColorsHexString","getHexString","folderCloud","folderMaterial","addColor","folderAnimate","Earth","_Earth","map","specularMap","specular","shininess","earthMesh","folderEarth","Moon","_Moon","moonMesh","x","z","pivotRotationsPerSecond","pivot","createPivot","Object3D","folderMoon","folderPosition","Sun","_Sun","sunLight","intensity","sunLensFlare","textures","sun","circle","hexagon","flareCircleSizeMax","lensFlares","size","distance","textureLoader","DirectionalLight","createLensFlare","getSunLensFlare","loadLensFlareTextures","LensFlare","getTextureByIndex","AdditiveBlending","addLensFlareSunCirclesAndHexagons","index","textureFlareSun","textureFlareCircle","textureFlareHexagon","refreshTextures","texture","folderSun","folderLight","folderLensFlares","_Scene","orbitControls","autoRotate","autoRotateSpeed","OrbitControls","applyParamsOrbitControlsAutoRotate","applyParamsOrbitControlsAutoRotateSpeed","enableDamping","refreshOrbitControls","folderOrbitControls","value","_SceneShadow","cameraHelper","shadow","castShadow","camera","right","left","top","bottom","mapSize","width","height","bias","setShadowConfiguration","CameraHelper","receiveShadow","updateShadow","shadowMap","type","PCFSoftShadowMap","shadowMapSoft","update","folderShadow","step","View","clock","helpClassname","_View","Clock","updateAll","addGui","help","addEventListener","dat","GUI","resetAll","helpElementStyle","getElementsByClassName","style","display","helpHideToggle","requestAnimationFrame","getDelta","render"],"mappings":"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","file":"src.4a36c2b8.map","sourceRoot":"..","sourcesContent":["var\r\n  ASSETS_PATH = 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/122460/',\r\n  DEFAULT = 'default',\r\n  IMAGE_SD = 'sd',\r\n  IMAGE_HD = 'hd',\r\n  COLOR_WHITE = 0xffffff,\r\n  COLOR_BLACK = 0x000000;\r\n\r\n/**\r\n* Utils\r\n*/\r\nvar Utils = {\r\n  windowRatio: function () {\r\n    return window.innerWidth / window.innerHeight;\r\n  }\r\n};\r\n\r\nconsole.log(window.innerWidth / window.innerHeight);\r\n/**\r\n* Renderer\r\n*/\r\nvar Renderer = (function () {\r\n  var _Renderer = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        webGLRenderer: {\r\n          antialias: false,\r\n          alpha: true,\r\n          clearColor: COLOR_BLACK,\r\n          canvasId: 'canvas-earth'\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.keepCurrentAntialias();\r\n\r\n      // @see also THREE.CanvasRenderer()\r\n      this.webGLRenderer = new THREE.WebGLRenderer({\r\n        antialias: params.webGLRenderer.antialias,\r\n        alpha: params.webGLRenderer.alpha\r\n      });\r\n\r\n      this.webGLRenderer.setClearColor(params.webGLRenderer.clearColor);\r\n      this.webGLRenderer.setPixelRatio(window.devicePixelRatio);\r\n      this.webGLRenderer.domElement.id = params.webGLRenderer.canvasId;\r\n\r\n      this.renderView();\r\n    };\r\n\r\n    this.refresh = function (antialias) {\r\n      this.setParamAntialias(antialias);\r\n\r\n      if (this.isAntialiasNotChanging()) {\r\n        return;\r\n      }\r\n\r\n      this.keepCurrentAntialias();\r\n\r\n      var canvasElement = document.getElementById(params.webGLRenderer.canvasId);\r\n      document.body.removeChild(canvasElement);\r\n      this.init();\r\n\r\n      Scene.activeOrbitControls();\r\n      SceneShadow.activeWebGLRendererShadowMap();\r\n    };\r\n\r\n    this.setParamAntialias = function (antialias) {\r\n      params.webGLRenderer.antialias = antialias || paramsDefault().webGLRenderer.antialias;\r\n    };\r\n\r\n    this.keepCurrentAntialias = function () {\r\n      params.webGLRenderer.previousAntialias = params.webGLRenderer.antialias;\r\n    };\r\n\r\n    this.isAntialiasNotChanging = function () {\r\n      return params.webGLRenderer.antialias === params.webGLRenderer.previousAntialias;\r\n    };\r\n\r\n    this.renderView = function () {\r\n      this.view = document.body;\r\n      this.view.appendChild(this.webGLRenderer.domElement);\r\n      this.updateSize();\r\n    };\r\n\r\n    this.updateSize = function () {\r\n      this.webGLRenderer.setSize(window.innerWidth, window.innerHeight);\r\n    };\r\n\r\n    this.gui = {\r\n      reset: function () {\r\n        self.refresh();\r\n      },\r\n\r\n      add: function (gui) {\r\n        var folderRenderer = gui.addFolder('RENDERER');\r\n\r\n        folderRenderer\r\n          .add(params.webGLRenderer, 'antialias').listen()\r\n          .onChange(function (antialias) {\r\n            self.refresh(antialias);\r\n          });\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Renderer();\r\n})();\r\n\r\n/**\r\n* Camera\r\n*/\r\nvar Camera = (function () {\r\n  var _Camera = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        perspectiveCamera: {\r\n          positionX: 0,\r\n          positionY: 0,\r\n          positionZ: 150,\r\n          fov: 63,\r\n          near: 1,\r\n          far: 8000\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.perspectiveCamera = new THREE.PerspectiveCamera(\r\n        params.perspectiveCamera.fov,\r\n        Utils.windowRatio(),\r\n        params.perspectiveCamera.near,\r\n        params.perspectiveCamera.far\r\n      );\r\n\r\n      this.perspectiveCamera.position.set(\r\n        params.perspectiveCamera.positionX,\r\n        params.perspectiveCamera.positionY,\r\n        params.perspectiveCamera.positionZ\r\n      );\r\n    };\r\n\r\n    this.updateAspect = function () {\r\n      this.perspectiveCamera.aspect = Utils.windowRatio();\r\n      this.perspectiveCamera.updateProjectionMatrix();\r\n    };\r\n\r\n    this.updateLookAt = function (target) {\r\n      this.perspectiveCamera.lookAt(target);\r\n    };\r\n\r\n    this.gui = {\r\n      params: {\r\n        colors: {}\r\n      },\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n\r\n        self.perspectiveCamera.fov = _default.perspectiveCamera.fov;\r\n        self.perspectiveCamera.near = _default.perspectiveCamera.near;\r\n        self.perspectiveCamera.far = _default.perspectiveCamera.far;\r\n\r\n        self.updateAspect();\r\n      },\r\n\r\n      add: function (gui) {\r\n        var folderCamera = gui.addFolder('CAMERA');\r\n\r\n        folderCamera\r\n          .add(self.perspectiveCamera, 'fov', 0, 150).listen()\r\n          .onChange(function () {\r\n            self.updateAspect();\r\n          });\r\n\r\n        folderCamera\r\n          .add(self.perspectiveCamera, 'near', 0, 5).listen()\r\n          .onChange(function () {\r\n            self.updateAspect();\r\n          });\r\n\r\n        folderCamera\r\n          .add(self.perspectiveCamera, 'far', 0, 10000).listen()\r\n          .onChange(function () {\r\n            self.updateAspect();\r\n          });\r\n\r\n        folderCamera\r\n          .add(this, 'reset').name('RESET CAMERA');\r\n\r\n        return folderCamera;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Camera();\r\n})();\r\n\r\n/**\r\n* Skymap\r\n*/\r\nvar Skymap = (function () {\r\n  var _Skymap = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        imgDef: IMAGE_HD,\r\n        imgDefPrevious: undefined,\r\n        cubeTextureLoader: {\r\n          positionTag: '{pos}',\r\n          positions: ['posx', 'negx', 'posy', 'negy', 'posz', 'negz'],\r\n          filename: {\r\n            sd: 'skymap_{pos}_512x512.jpg',\r\n            hd: 'skymap_{pos}_1024x1024.jpg'\r\n          }\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () { };\r\n\r\n    this.setParamImgDef = function (imgDef) {\r\n      params.imgDef = imgDef || paramsDefault().imgDef;\r\n    };\r\n\r\n    this.setSceneBgCubeTexture = function (_scene, imgDef) {\r\n      this.setParamImgDef(imgDef);\r\n      if (this.doesRefreshTextureNecessary()) {\r\n        _scene.background = this.getCubeTextureLoader();\r\n        this.disableRefreshTexture();\r\n      }\r\n    };\r\n\r\n    this.getCubeTextureLoader = function () {\r\n      return new THREE.CubeTextureLoader()\r\n        .setPath(ASSETS_PATH)\r\n        .load(this.getFilenames());\r\n    };\r\n\r\n    this.getFilenames = function () {\r\n      var filenames = [];\r\n\r\n      for (var i = 0; i < params.cubeTextureLoader.positions.length; i++) {\r\n        filenames.push(\r\n          this.getFilename(params.cubeTextureLoader.positions[i])\r\n        );\r\n      }\r\n\r\n      return filenames;\r\n    };\r\n\r\n    this.getFilename = function (position) {\r\n      return params.cubeTextureLoader.filename[params.imgDef].replace(\r\n        params.cubeTextureLoader.positionTag,\r\n        position\r\n      );\r\n    };\r\n\r\n    this.doesRefreshTextureNecessary = function () {\r\n      return params.imgDef !== params.imgDefPrevious;\r\n    };\r\n\r\n    this.disableRefreshTexture = function () {\r\n      params.imgDefPrevious = params.imgDef;\r\n    };\r\n\r\n    this.gui = {\r\n      params: {},\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n        self.setSceneBgCubeTexture(Scene.scene, _default.imgDef);\r\n      },\r\n\r\n      add: function (gui) {\r\n        var folderSkymap = gui.addFolder('SKYMAP');\r\n\r\n        folderSkymap\r\n          .add(params, 'imgDef', [IMAGE_SD, IMAGE_HD]).listen()\r\n          .onChange(function (imgDef) {\r\n            self.setSceneBgCubeTexture(Scene.scene, imgDef);\r\n          });\r\n\r\n        folderSkymap\r\n          .add(this, 'reset').name('RESET SKYMAP');\r\n\r\n        return folderSkymap;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Skymap();\r\n})();\r\n\r\n/**\r\n* Cloud\r\n*/\r\nvar Cloud = (function () {\r\n  var _Cloud = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        imgDef: IMAGE_SD,\r\n        imgDefPrevious: undefined,\r\n        visible: true,\r\n        material: {\r\n          wireframe: false,\r\n          transparent: true,\r\n          color: COLOR_WHITE,\r\n          bumpScale: 0.13,\r\n          opacity: 0.9,\r\n          alphaMap: {\r\n            sd: ASSETS_PATH + 'earth_clouds_1024x512.jpg',\r\n            hd: ASSETS_PATH + 'earth_clouds_2048x1024.jpg'\r\n          },\r\n          bumpMap: {\r\n            sd: ASSETS_PATH + 'earth_clouds_1024x512.jpg',\r\n            hd: ASSETS_PATH + 'earth_clouds_2048x1024.jpg'\r\n          }\r\n        },\r\n        geometry: {\r\n          radius: 50.3,\r\n          widthSegments: 64,\r\n          heightSegments: 32\r\n        },\r\n        animate: {\r\n          enabled: true,\r\n          rotationsYPerSecond: -0.0012\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.material = new THREE.MeshPhongMaterial({\r\n        wireframe: params.material.wireframe,\r\n        color: params.material.color,\r\n        opacity: params.material.opacity,\r\n        transparent: params.material.transparent,\r\n        bumpScale: params.material.bumpScale\r\n      });\r\n\r\n      this.setMaterialTextures();\r\n\r\n      this.geometry = new THREE.SphereGeometry(\r\n        params.geometry.radius,\r\n        params.geometry.widthSegments,\r\n        params.geometry.heightSegments\r\n      );\r\n\r\n      this.cloudMesh = new THREE.Mesh(this.geometry, this.material);\r\n      this.cloudMesh.visible = params.visible;\r\n    };\r\n\r\n    this.animate = function (delta) {\r\n      if (params.animate.enabled) {\r\n        this.cloudMesh.rotation.y += delta * 2 * Math.PI * params.animate.rotationsYPerSecond;\r\n      }\r\n    };\r\n\r\n    this.setParamImgDef = function (imgDef) {\r\n      params.imgDef = imgDef || paramsDefault().imgDef;\r\n    };\r\n\r\n    this.setMaterialTextures = function (imgDef) {\r\n      this.setParamImgDef(imgDef);\r\n\r\n      if (this.doesRefreshTextureNecessary()) {\r\n        this.material.alphaMap = new THREE.TextureLoader().load(params.material.alphaMap[params.imgDef]);\r\n        this.material.bumpMap = new THREE.TextureLoader().load(params.material.bumpMap[params.imgDef]);\r\n        this.disableRefreshTexture();\r\n      }\r\n    };\r\n\r\n    this.doesRefreshTextureNecessary = function () {\r\n      return params.imgDef !== params.imgDefPrevious;\r\n    };\r\n\r\n    this.disableRefreshTexture = function () {\r\n      params.imgDefPrevious = params.imgDef;\r\n    };\r\n\r\n    this.gui = {\r\n      params: {\r\n        colors: {}\r\n      },\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n\r\n        self.cloudMesh.visible = _default.visible;\r\n\r\n        self.material.wireframe = _default.material.wireframe;\r\n        self.material.transparent = _default.material.transparent;\r\n        self.material.opacity = _default.material.opacity;\r\n        self.material.bumpScale = _default.material.bumpScale;\r\n        self.material.color.setHex(_default.material.color);\r\n\r\n        params.animate.enabled = _default.animate.enabled;\r\n        params.animate.rotationsYPerSecond = _default.animate.rotationsYPerSecond;\r\n\r\n        self.setMaterialTextures(_default.imgDef);\r\n\r\n        this.resetColorsHexString();\r\n      },\r\n\r\n      resetColorsHexString: function () {\r\n        this.params.colors.color = '#' + self.material.color.getHexString();\r\n      },\r\n\r\n      add: function (gui) {\r\n        this.resetColorsHexString();\r\n\r\n        var folderCloud = gui.addFolder('CLOUD');\r\n\r\n        folderCloud\r\n          .add(self.cloudMesh, 'visible').listen();\r\n\r\n        var folderMaterial = folderCloud.addFolder('Material');\r\n\r\n        folderMaterial\r\n          .add(params, 'imgDef', [IMAGE_SD, IMAGE_HD]).listen()\r\n          .onChange(function (imgDef) {\r\n            self.setMaterialTextures(imgDef);\r\n          });\r\n\r\n        folderMaterial\r\n          .add(self.material, 'wireframe').listen();\r\n\r\n        folderMaterial\r\n          .add(self.material, 'transparent').listen();\r\n\r\n        folderMaterial\r\n          .add(self.material, 'opacity', 0, 1).listen();\r\n\r\n        folderMaterial\r\n          .add(self.material, 'bumpScale', -1.5, 1.5).listen();\r\n\r\n        folderMaterial\r\n          .addColor(this.params.colors, 'color').listen()\r\n          .onChange(function (color) {\r\n            self.material.color.setHex(color.replace('#', '0x'));\r\n          });\r\n\r\n        var folderAnimate = folderCloud.addFolder('Animate');\r\n\r\n        folderAnimate\r\n          .add(params.animate, 'enabled').listen();\r\n\r\n        folderAnimate\r\n          .add(params.animate, 'rotationsYPerSecond', -2, 2).listen();\r\n\r\n        folderCloud\r\n          .add(this, 'reset').name('RESET CLOUD');\r\n\r\n        return folderCloud;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Cloud();\r\n})();\r\n\r\n/**\r\n* Earth\r\n*/\r\nvar Earth = (function (Cloud) {\r\n  var _Earth = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        imgDef: IMAGE_SD,\r\n        imgDefPrevious: undefined,\r\n        visible: true,\r\n        material: {\r\n          wireframe: false,\r\n          map: {\r\n            sd: ASSETS_PATH + 'earth_map_1024x512.jpg',\r\n            hd: ASSETS_PATH + 'earth_map_2048x1024.jpg'\r\n          },\r\n          bumpMap: {\r\n            sd: ASSETS_PATH + 'earth_bump_1024x512.jpg',\r\n            hd: ASSETS_PATH + 'earth_bump_2048x1024.jpg'\r\n          },\r\n          bumpScale: 0.45,\r\n          specularMap: {\r\n            sd: ASSETS_PATH + 'earth_specular_1024x512.jpg',\r\n            hd: ASSETS_PATH + 'earth_specular_2048x1024.jpg'\r\n          },\r\n          specular: 0x2d4ea0,\r\n          shininess: 6\r\n        },\r\n        geometry: {\r\n          radius: 50,\r\n          widthSegments: 64,\r\n          heightSegments: 32\r\n        },\r\n        animate: {\r\n          enabled: true,\r\n          rotationsYPerSecond: 0.01\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.geometry = new THREE.SphereGeometry(\r\n        params.geometry.radius,\r\n        params.geometry.widthSegments,\r\n        params.geometry.heightSegments\r\n      );\r\n\r\n      this.material = new THREE.MeshPhongMaterial({\r\n        wireframe: params.material.wireframe,\r\n        bumpScale: params.material.bumpScale,\r\n        specular: params.material.specular,\r\n        shininess: params.material.shininess\r\n      });\r\n\r\n      this.setMaterialTextures();\r\n\r\n      this.earthMesh = new THREE.Mesh(this.geometry, this.material);\r\n      this.earthMesh.visible = params.visible;\r\n\r\n      this.earthMesh.add(Cloud.cloudMesh);\r\n    };\r\n\r\n    this.animate = function (delta) {\r\n      if (params.animate.enabled) {\r\n        this.earthMesh.rotation.y += delta * 2 * Math.PI * params.animate.rotationsYPerSecond;\r\n      }\r\n    };\r\n\r\n    this.setParamImgDef = function (imgDef) {\r\n      params.imgDef = imgDef || paramsDefault().imgDef;\r\n    };\r\n\r\n    this.setMaterialTextures = function (imgDef) {\r\n      this.setParamImgDef(imgDef);\r\n\r\n      if (this.doesRefreshTextureNecessary()) {\r\n        this.material.map = new THREE.TextureLoader().load(params.material.map[params.imgDef]);\r\n        this.material.bumpMap = new THREE.TextureLoader().load(params.material.bumpMap[params.imgDef]);\r\n        this.material.specularMap = new THREE.TextureLoader().load(params.material.specularMap[params.imgDef]);\r\n        this.disableRefreshTexture();\r\n      }\r\n    };\r\n\r\n    this.doesRefreshTextureNecessary = function () {\r\n      return params.imgDef !== params.imgDefPrevious;\r\n    };\r\n\r\n    this.disableRefreshTexture = function () {\r\n      params.imgDefPrevious = params.imgDef;\r\n    };\r\n\r\n    this.gui = {\r\n      params: {\r\n        colors: {}\r\n      },\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n\r\n        self.earthMesh.visible = _default.visible;\r\n\r\n        self.material.wireframe = _default.material.wireframe;\r\n        self.material.bumpScale = _default.material.bumpScale;\r\n        self.material.shininess = _default.material.shininess;\r\n        self.material.specular.setHex(_default.material.specular);\r\n\r\n        params.animate.enabled = _default.animate.enabled;\r\n        params.animate.rotationsYPerSecond = _default.animate.rotationsYPerSecond;\r\n\r\n        self.setMaterialTextures(_default.imgDef);\r\n\r\n        this.resetColorsHexString();\r\n      },\r\n\r\n      resetColorsHexString: function () {\r\n        this.params.colors.specular = '#' + self.material.specular.getHexString();\r\n      },\r\n\r\n      add: function (gui) {\r\n        this.resetColorsHexString();\r\n\r\n        var folderEarth = gui.addFolder('EARTH');\r\n\r\n        folderEarth\r\n          .add(self.earthMesh, 'visible').listen();\r\n\r\n        var folderMaterial = folderEarth.addFolder('Material');\r\n\r\n        folderMaterial\r\n          .add(params, 'imgDef', [IMAGE_SD, IMAGE_HD]).listen()\r\n          .onChange(function (imgDef) {\r\n            self.setMaterialTextures(imgDef);\r\n          });\r\n\r\n        folderMaterial\r\n          .add(self.material, 'wireframe').listen();\r\n\r\n        folderMaterial\r\n          .add(self.material, 'bumpScale', -1.5, 1.5).listen();\r\n\r\n        folderMaterial\r\n          .add(self.material, 'shininess', 0, 10).listen();\r\n\r\n        folderMaterial\r\n          .addColor(this.params.colors, 'specular').listen()\r\n          .onChange(function (color) {\r\n            self.material.specular.setHex(color.replace('#', '0x'));\r\n          });\r\n\r\n        var folderAnimate = folderEarth.addFolder('Animate');\r\n\r\n        folderAnimate\r\n          .add(params.animate, 'enabled').listen();\r\n\r\n        folderAnimate\r\n          .add(params.animate, 'rotationsYPerSecond', -2, 2).listen();\r\n\r\n        folderEarth\r\n          .add(this, 'reset').name('RESET EARTH');\r\n\r\n        return folderEarth;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Earth();\r\n})(Cloud);\r\n\r\n/**\r\n* Moon\r\n*/\r\nvar Moon = (function (Earth) {\r\n  var _Moon = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        imgDef: IMAGE_SD,\r\n        imgDefPrevious: undefined,\r\n        moonMesh: {\r\n          visible: true,\r\n          position: {\r\n            x: 0,\r\n            y: 0,\r\n            z: -100,\r\n          },\r\n        },\r\n        material: {\r\n          wireframe: false,\r\n          map: {\r\n            sd: ASSETS_PATH + 'moon_map_512x256.jpg',\r\n            hd: ASSETS_PATH + 'moon_map_1024x512.jpg'\r\n          },\r\n          bumpMap: {\r\n            sd: ASSETS_PATH + 'moon_bump_512x256.jpg',\r\n            hd: ASSETS_PATH + 'moon_bump_1024x512.jpg'\r\n          },\r\n          bumpScale: 0.1,\r\n          shininess: 0\r\n        },\r\n        geometry: {\r\n          radius: 10,\r\n          widthSegments: 32,\r\n          heightSegments: 16\r\n        },\r\n        animate: {\r\n          enabled: true,\r\n          pivotRotationsPerSecond: 0.05\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.geometry = new THREE.SphereGeometry(\r\n        params.geometry.radius,\r\n        params.geometry.widthSegments,\r\n        params.geometry.heightSegments\r\n      );\r\n\r\n      this.material = new THREE.MeshPhongMaterial({\r\n        wireframe: params.material.wireframe,\r\n        bumpScale: params.material.bumpScale,\r\n        shininess: params.material.shininess\r\n      });\r\n\r\n      this.setMaterialTextures();\r\n\r\n      this.moonMesh = new THREE.Mesh(this.geometry, this.material);\r\n\r\n      this.moonMesh.position.set(\r\n        params.moonMesh.position.x,\r\n        params.moonMesh.position.y,\r\n        params.moonMesh.position.z\r\n      );\r\n\r\n      this.moonMesh.visible = params.moonMesh.visible;\r\n      this.pivot = this.createPivot();\r\n    };\r\n\r\n    this.createPivot = function () {\r\n      var pivot = new THREE.Object3D();\r\n      pivot.position = Earth.earthMesh.position;\r\n      pivot.add(this.moonMesh);\r\n\r\n      return pivot;\r\n    };\r\n\r\n    this.animate = function (delta) {\r\n      if (params.animate.enabled) {\r\n        this.pivot.rotation.y += delta * 2 * Math.PI * params.animate.pivotRotationsPerSecond;\r\n      }\r\n    };\r\n\r\n    this.setParamImgDef = function (imgDef) {\r\n      params.imgDef = imgDef || paramsDefault().imgDef;\r\n    };\r\n\r\n    this.setMaterialTextures = function (imgDef) {\r\n      this.setParamImgDef(imgDef);\r\n\r\n      if (this.doesRefreshTextureNecessary()) {\r\n        this.material.map = new THREE.TextureLoader().load(params.material.map[params.imgDef]);\r\n        this.material.bumpMap = new THREE.TextureLoader().load(params.material.bumpMap[params.imgDef]);\r\n        this.disableRefreshTexture();\r\n      }\r\n    };\r\n\r\n    this.doesRefreshTextureNecessary = function () {\r\n      return params.imgDef !== params.imgDefPrevious;\r\n    };\r\n\r\n    this.disableRefreshTexture = function () {\r\n      params.imgDefPrevious = params.imgDef;\r\n    };\r\n\r\n    this.gui = {\r\n      params: {\r\n        colors: {}\r\n      },\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n\r\n        self.moonMesh.visible = _default.moonMesh.visible;\r\n\r\n        self.material.wireframe = _default.material.wireframe;\r\n        self.material.bumpScale = _default.material.bumpScale;\r\n        self.material.shininess = _default.material.shininess;\r\n\r\n        self.moonMesh.position.x = _default.moonMesh.position.x;\r\n        self.moonMesh.position.y = _default.moonMesh.position.y;\r\n        self.moonMesh.position.z = _default.moonMesh.position.z;\r\n\r\n        params.animate.enabled = _default.animate.enabled;\r\n        params.animate.pivotRotationsPerSecond = _default.animate.pivotRotationsPerSecond;\r\n\r\n        self.setMaterialTextures(_default.imgDef);\r\n      },\r\n\r\n      add: function (gui) {\r\n        var folderMoon = gui.addFolder('MOON');\r\n\r\n        folderMoon\r\n          .add(self.moonMesh, 'visible').listen();\r\n\r\n        var folderPosition = folderMoon.addFolder('Position');\r\n\r\n        folderPosition\r\n          .add(self.moonMesh.position, 'x', -100, 100).listen();\r\n\r\n        folderPosition\r\n          .add(self.moonMesh.position, 'y', -100, 100).listen();\r\n\r\n        folderPosition\r\n          .add(self.moonMesh.position, 'z', -100, 100).listen();\r\n\r\n        var folderMaterial = folderMoon.addFolder('Material');\r\n\r\n        folderMaterial\r\n          .add(params, 'imgDef', [IMAGE_SD, IMAGE_HD]).listen()\r\n          .onChange(function (imgDef) {\r\n            self.setMaterialTextures(imgDef);\r\n          });\r\n\r\n        folderMaterial\r\n          .add(self.material, 'wireframe').listen();\r\n\r\n        folderMaterial\r\n          .add(self.material, 'bumpScale', -1.5, 1.5).listen();\r\n\r\n        folderMaterial\r\n          .add(self.material, 'shininess', 0, 10).listen();\r\n\r\n        var folderAnimate = folderMoon.addFolder('Animate');\r\n\r\n        folderAnimate\r\n          .add(params.animate, 'enabled').listen();\r\n\r\n        folderAnimate\r\n          .add(params.animate, 'pivotRotationsPerSecond', -2, 2).listen();\r\n\r\n        folderMoon\r\n          .add(this, 'reset').name('RESET MOON');\r\n\r\n        return folderMoon;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Moon();\r\n})(Earth);\r\n\r\n/**\r\n* Sun\r\n*/\r\nvar Sun = (function () {\r\n  var _Sun = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        imgDef: IMAGE_HD,\r\n        imgDefPrevious: undefined,\r\n        sunLight: {\r\n          visible: true,\r\n          color: COLOR_WHITE,\r\n          intensity: 1.3,\r\n          position: {\r\n            x: -380,\r\n            y: 240,\r\n            z: -1000,\r\n          }\r\n        },\r\n        sunLensFlare: {\r\n          textures: {\r\n            sun: {\r\n              sd: ASSETS_PATH + 'lens_flare_sun_512x512.jpg',\r\n              hd: ASSETS_PATH + 'lens_flare_sun_1024x1024.jpg'\r\n            },\r\n            circle: {\r\n              sd: ASSETS_PATH + 'lens_flare_circle_32x32.jpg',\r\n              hd: ASSETS_PATH + 'lens_flare_circle_64x64.jpg'\r\n            },\r\n            hexagon: {\r\n              sd: ASSETS_PATH + 'lens_flare_hexagon_128x128.jpg',\r\n              hd: ASSETS_PATH + 'lens_flare_hexagon_256x256.jpg'\r\n            }\r\n          },\r\n          flareCircleSizeMax: 70,\r\n          lensFlares: [{\r\n            size: 1400,\r\n            opacity: 1,\r\n            distance: 0\r\n          }, {\r\n            size: 20,\r\n            opacity: 0.4,\r\n            distance: 0.63\r\n          }, {\r\n            size: 40,\r\n            opacity: 0.3,\r\n            distance: 0.64\r\n          }, {\r\n            size: 70,\r\n            opacity: 0.8,\r\n            distance: 0.7\r\n          }, {\r\n            size: 110,\r\n            opacity: 0.7,\r\n            distance: 0.8\r\n          }, {\r\n            size: 60,\r\n            opacity: 0.4,\r\n            distance: 0.85\r\n          }, {\r\n            size: 30,\r\n            opacity: 0.4,\r\n            distance: 0.86\r\n          }, {\r\n            size: 120,\r\n            opacity: 0.3,\r\n            distance: 0.9\r\n          }, {\r\n            size: 260,\r\n            opacity: 0.4,\r\n            distance: 1\r\n          }]\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.textureLoader = new THREE.TextureLoader();\r\n      this.sunLight = new THREE.DirectionalLight(params.sunLight.color, params.sunLight.intensity);\r\n\r\n      this.sunLight.position.set(\r\n        params.sunLight.position.x,\r\n        params.sunLight.position.y,\r\n        params.sunLight.position.z\r\n      );\r\n\r\n      this.sunLight.visible = params.sunLight.visible;\r\n\r\n      this.createLensFlare();\r\n      this.disableRefreshTexture();\r\n    };\r\n\r\n    this.setParamImgDef = function (imgDef) {\r\n      params.imgDef = imgDef || paramsDefault().imgDef;\r\n    };\r\n\r\n    this.createLensFlare = function () {\r\n      this.sunLensFlare = this.getSunLensFlare();\r\n      this.sunLight.add(this.sunLensFlare);\r\n    };\r\n\r\n    this.getSunLensFlare = function () {\r\n      this.loadLensFlareTextures();\r\n\r\n      var sunLensFlare = new THREE.LensFlare(\r\n        this.getTextureByIndex(0),\r\n        params.sunLensFlare.lensFlares[0].size,\r\n        params.sunLensFlare.lensFlares[0].distance,\r\n        THREE.AdditiveBlending\r\n      );\r\n\r\n      return this.addLensFlareSunCirclesAndHexagons(sunLensFlare);\r\n    };\r\n\r\n    this.addLensFlareSunCirclesAndHexagons = function (sunLensFlare) {\r\n      for (var i = 1; i < params.sunLensFlare.lensFlares.length; i++) {\r\n        sunLensFlare.add(\r\n          this.getTextureByIndex(i),\r\n          params.sunLensFlare.lensFlares[i].size,\r\n          params.sunLensFlare.lensFlares[i].distance,\r\n          THREE.AdditiveBlending\r\n        );\r\n      }\r\n\r\n      return sunLensFlare;\r\n    };\r\n\r\n    this.getTextureByIndex = function (index) {\r\n      if (0 === index) {\r\n        return this.textureFlareSun;\r\n      }\r\n      return params.sunLensFlare.lensFlares[index].size < params.sunLensFlare.flareCircleSizeMax ?\r\n        this.textureFlareCircle :\r\n        this.textureFlareHexagon;\r\n    };\r\n\r\n    this.loadLensFlareTextures = function () {\r\n      this.textureFlareSun = this.textureLoader.load(params.sunLensFlare.textures.sun[params.imgDef]);\r\n      this.textureFlareCircle = this.textureLoader.load(params.sunLensFlare.textures.circle[params.imgDef]);\r\n      this.textureFlareHexagon = this.textureLoader.load(params.sunLensFlare.textures.hexagon[params.imgDef]);\r\n    };\r\n\r\n    this.refreshTextures = function (imgDef) {\r\n      this.setParamImgDef(imgDef);\r\n\r\n      if (this.doesRefreshTextureNecessary()) {\r\n        this.loadLensFlareTextures();\r\n\r\n        for (var i = 0; i < params.sunLensFlare.lensFlares.length; i++) {\r\n          this.sunLensFlare.lensFlares[i].texture = this.getTextureByIndex(i);\r\n        }\r\n\r\n        this.disableRefreshTexture();\r\n      }\r\n    };\r\n\r\n    this.doesRefreshTextureNecessary = function () {\r\n      return params.imgDef !== params.imgDefPrevious;\r\n    };\r\n\r\n    this.disableRefreshTexture = function () {\r\n      params.imgDefPrevious = params.imgDef;\r\n    };\r\n\r\n    this.gui = {\r\n      params: {\r\n        colors: {}\r\n      },\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n\r\n        self.sunLight.visible = _default.sunLight.visible;\r\n        self.sunLight.intensity = _default.sunLight.intensity;\r\n        self.sunLight.color.setHex(_default.sunLight.color);\r\n\r\n        self.sunLight.position.x = _default.sunLight.position.x;\r\n        self.sunLight.position.y = _default.sunLight.position.y;\r\n        self.sunLight.position.z = _default.sunLight.position.z;\r\n\r\n        for (var i = 0; i < params.sunLensFlare.lensFlares.length; i++) {\r\n          self.sunLensFlare.lensFlares[i].size = _default.sunLensFlare.lensFlares[i].size;\r\n          self.sunLensFlare.lensFlares[i].opacity = _default.sunLensFlare.lensFlares[i].opacity;\r\n          self.sunLensFlare.lensFlares[i].distance = _default.sunLensFlare.lensFlares[i].distance;\r\n        }\r\n\r\n        this.resetColorsHexString();\r\n\r\n        self.refreshTextures();\r\n      },\r\n\r\n      resetColorsHexString: function () {\r\n        this.params.colors.color = '#' + self.sunLight.color.getHexString();\r\n      },\r\n\r\n      add: function (gui) {\r\n        this.resetColorsHexString();\r\n\r\n        var folderSun = gui.addFolder('SUN');\r\n\r\n        folderSun\r\n          .add(self.sunLight, 'visible').listen();\r\n\r\n        var folderLight = folderSun.addFolder('Light');\r\n\r\n        folderLight\r\n          .add(self.sunLight, 'intensity', 0, 10).listen();\r\n\r\n        folderLight\r\n          .addColor(this.params.colors, 'color').listen()\r\n          .onChange(function (color) {\r\n            self.sunLight.color.setHex(color.replace('#', '0x'));\r\n          });\r\n\r\n        var folderPosition = folderSun.addFolder('Position');\r\n\r\n        folderPosition\r\n          .add(self.sunLight.position, 'x', -2000, 2000).listen();\r\n\r\n        folderPosition\r\n          .add(self.sunLight.position, 'y', -2000, 2000).listen();\r\n\r\n        folderPosition\r\n          .add(self.sunLight.position, 'z', -2000, 2000).listen();\r\n\r\n        var folderLensFlares = folderSun.addFolder('LensFlares');\r\n\r\n        folderLensFlares\r\n          .add(params, 'imgDef', [IMAGE_SD, IMAGE_HD]).listen()\r\n          .onChange(function (imgDef) {\r\n            self.refreshTextures(imgDef);\r\n          });\r\n\r\n        for (var i = 0; i < self.sunLensFlare.lensFlares.length; i++) {\r\n          folderLensFlares\r\n            .add(self.sunLensFlare.lensFlares[i], 'size', 0, 2000).name(i + '. size').listen();\r\n\r\n          folderLensFlares\r\n            .add(self.sunLensFlare.lensFlares[i], 'opacity', 0, 1).name(i + '. opacity').listen();\r\n\r\n          folderLensFlares\r\n            .add(self.sunLensFlare.lensFlares[i], 'distance', -1, 1).name(i + '. distance').listen();\r\n        }\r\n\r\n        folderSun\r\n          .add(this, 'reset').name('RESET SUN');\r\n\r\n        return folderSun;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Sun();\r\n})();\r\n\r\n/**\r\n* Scene\r\n*/\r\nvar Scene = (function () {\r\n  var _Scene = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        orbitControls: {\r\n          autoRotate: true,\r\n          autoRotateSpeed: 0.07\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.scene = new THREE.Scene();\r\n      this.scene.add(Earth.earthMesh);\r\n      this.scene.add(Moon.pivot);\r\n      this.scene.add(Sun.sunLight);\r\n\r\n      Skymap.setSceneBgCubeTexture(this.scene);\r\n\r\n      this.activeOrbitControls();\r\n    };\r\n\r\n    this.activeOrbitControls = function () {\r\n      this.orbitControls = new THREE.OrbitControls(\r\n        Camera.perspectiveCamera,\r\n        Renderer.webGLRenderer.domElement\r\n      );\r\n\r\n      this.applyParamsOrbitControlsAutoRotate();\r\n      this.applyParamsOrbitControlsAutoRotateSpeed();\r\n\r\n      this.orbitControls.enableDamping = true;\r\n    };\r\n\r\n    this.applyParamsOrbitControlsAutoRotate = function () {\r\n      this.orbitControls.autoRotate = params.orbitControls.autoRotate;\r\n    };\r\n\r\n    this.applyParamsOrbitControlsAutoRotateSpeed = function () {\r\n      this.orbitControls.autoRotateSpeed = params.orbitControls.autoRotateSpeed;\r\n    };\r\n\r\n    this.refreshOrbitControls = function () {\r\n      this.activeOrbitControls();\r\n      this.gui.reset();\r\n    };\r\n\r\n    this.gui = {\r\n      params: {\r\n        colors: {}\r\n      },\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n\r\n        params.orbitControls.autoRotate = _default.orbitControls.autoRotate;\r\n        params.orbitControls.autoRotateSpeed = _default.orbitControls.autoRotateSpeed;\r\n\r\n        self.applyParamsOrbitControlsAutoRotate();\r\n        self.applyParamsOrbitControlsAutoRotateSpeed();\r\n      },\r\n\r\n      add: function (gui) {\r\n        var folderOrbitControls = gui.addFolder('ORBIT CONTROLS');\r\n\r\n        folderOrbitControls\r\n          .add(params.orbitControls, 'autoRotate').listen()\r\n          .onChange(function (value) {\r\n            self.applyParamsOrbitControlsAutoRotate();\r\n          });\r\n\r\n        folderOrbitControls\r\n          .add(params.orbitControls, 'autoRotateSpeed', -1, 1).listen()\r\n          .onChange(function (value) {\r\n            self.applyParamsOrbitControlsAutoRotateSpeed();\r\n          });\r\n\r\n        folderOrbitControls\r\n          .add(this, 'reset').name('RESET CONTR.');\r\n\r\n        return folderOrbitControls;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _Scene();\r\n})();\r\n\r\n/**\r\n* SceneShadow\r\n*/\r\nvar SceneShadow = (function (Scene) {\r\n  var _SceneShadow = function () {\r\n    var self = this;\r\n\r\n    var paramsDefault = function () {\r\n      return {\r\n        cameraHelper: {\r\n          visible: false\r\n        },\r\n        shadow: {\r\n          castShadow: true,\r\n          camera: {\r\n            near: 950,\r\n            far: 1250,\r\n            right: 150,\r\n            left: -150,\r\n            top: 150,\r\n            bottom: -150\r\n          },\r\n          mapSize: {\r\n            width: 512,\r\n            height: 512\r\n          },\r\n          bias: 0\r\n        }\r\n      };\r\n    };\r\n\r\n    var params = paramsDefault();\r\n\r\n    this.init = function () {\r\n      this.setShadowConfiguration();\r\n    };\r\n\r\n    this.setShadowConfiguration = function () {\r\n      this.cameraHelper = new THREE.CameraHelper(Sun.sunLight.shadow.camera);\r\n      Scene.scene.add(this.cameraHelper);\r\n      this.cameraHelper.visible = params.cameraHelper.visible;\r\n\r\n      Sun.sunLight.castShadow = params.shadow.castShadow;\r\n      Sun.sunLight.shadow.camera.near = params.shadow.camera.near;\r\n      Sun.sunLight.shadow.camera.far = params.shadow.camera.far;\r\n      Sun.sunLight.shadow.mapSize.width = params.shadow.mapSize.width;\r\n      Sun.sunLight.shadow.mapSize.height = params.shadow.mapSize.height;\r\n      Sun.sunLight.shadow.bias = params.shadow.bias;\r\n\r\n      Sun.sunLight.shadow.camera.right = params.shadow.camera.right;\r\n      Sun.sunLight.shadow.camera.left = params.shadow.camera.left;\r\n      Sun.sunLight.shadow.camera.top = params.shadow.camera.top;\r\n      Sun.sunLight.shadow.camera.bottom = params.shadow.camera.bottom;\r\n\r\n      Earth.earthMesh.castShadow = true;\r\n      Earth.earthMesh.receiveShadow = true;\r\n\r\n      Cloud.cloudMesh.receiveShadow = true;\r\n\r\n      Moon.moonMesh.castShadow = true;\r\n      Moon.moonMesh.receiveShadow = true;\r\n\r\n      this.activeWebGLRendererShadowMap();\r\n\r\n      this.updateShadow();\r\n    };\r\n\r\n    this.activeWebGLRendererShadowMap = function () {\r\n      Renderer.webGLRenderer.shadowMap.enabled = true;\r\n      Renderer.webGLRenderer.shadowMap.type = THREE.PCFSoftShadowMap;\r\n      Renderer.webGLRenderer.shadowMapSoft = true;\r\n    };\r\n\r\n    this.updateShadow = function () {\r\n      Sun.sunLight.shadow.camera.updateProjectionMatrix();\r\n      this.cameraHelper.update();\r\n    };\r\n\r\n    this.gui = {\r\n      params: {\r\n        colors: {}\r\n      },\r\n\r\n      reset: function () {\r\n        var _default = paramsDefault();\r\n\r\n        //self.cameraHelper.visible = _default.cameraHelper.visible;\r\n\r\n        Sun.sunLight.castShadow = _default.shadow.castShadow;\r\n        Sun.sunLight.shadow.camera.near = _default.shadow.camera.near;\r\n        Sun.sunLight.shadow.camera.far = _default.shadow.camera.far;\r\n        Sun.sunLight.shadow.mapSize.width = _default.shadow.mapSize.width;\r\n        Sun.sunLight.shadow.mapSize.height = _default.shadow.mapSize.height;\r\n        Sun.sunLight.shadow.bias = _default.shadow.bias;\r\n\r\n        Sun.sunLight.shadow.camera.right = _default.shadow.camera.right;\r\n        Sun.sunLight.shadow.camera.left = _default.shadow.camera.left;\r\n        Sun.sunLight.shadow.camera.top = _default.shadow.camera.top;\r\n        Sun.sunLight.shadow.camera.bottom = _default.shadow.camera.bottom;\r\n\r\n        self.updateShadow();\r\n      },\r\n\r\n      add: function (gui) {\r\n        var folderShadow = gui.addFolder('SHADOW');\r\n\r\n        folderShadow\r\n          .add(self.cameraHelper, 'visible').name('cameraHelper').listen();\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight, 'castShadow').listen();\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.camera, 'near').step(10).listen()\r\n          .onChange(function () {\r\n            self.updateShadow();\r\n          });\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.camera, 'far').step(10).listen()\r\n          .onChange(function () {\r\n            self.updateShadow();\r\n          });\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.mapSize, 'width', 0, 2048).listen();\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.mapSize, 'height', 0, 2048).listen();\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow, 'bias', 0, 0.4).step(0.001).listen()\r\n          .onChange(function () {\r\n            self.updateShadow();\r\n          });\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.camera, 'right').step(10).listen()\r\n          .onChange(function () {\r\n            self.updateShadow();\r\n          });\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.camera, 'left').step(10).listen()\r\n          .onChange(function () {\r\n            self.updateShadow();\r\n          });\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.camera, 'top').step(10).listen()\r\n          .onChange(function () {\r\n            self.updateShadow();\r\n          });\r\n\r\n        folderShadow\r\n          .add(Sun.sunLight.shadow.camera, 'bottom').step(10).listen()\r\n          .onChange(function () {\r\n            self.updateShadow();\r\n          });\r\n\r\n        folderShadow\r\n          .add(this, 'reset').name('RESET SHADOW');\r\n\r\n        return folderShadow;\r\n      }\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _SceneShadow();\r\n})(Scene);\r\n\r\n/**\r\n* View\r\n*/\r\nvar View = (function () {\r\n  var self = this,\r\n    clock, delta;\r\n\r\n  var params = {\r\n    imgDef: DEFAULT,\r\n    helpClassname: 'help'\r\n  };\r\n\r\n  var _View = function () {\r\n    this.init = function () {\r\n      clock = new THREE.Clock();\r\n\r\n      this.updateAll();\r\n      this.addGui();\r\n      this.help();\r\n\r\n      animate();\r\n\r\n      window.addEventListener('resize', this.updateAll, false);\r\n    };\r\n\r\n    this.addGui = function () {\r\n      var gui = new dat.GUI();\r\n\r\n      Scene.gui.add(gui);\r\n      Camera.gui.add(gui);\r\n      Skymap.gui.add(gui);\r\n      Sun.gui.add(gui);\r\n      folderEarth = Earth.gui.add(gui);\r\n      Cloud.gui.add(folderEarth);\r\n      Moon.gui.add(gui);\r\n      SceneShadow.gui.add(gui);\r\n      Renderer.gui.add(gui);\r\n\r\n      gui.add(params, 'imgDef', [DEFAULT, IMAGE_SD, IMAGE_HD]).name('IMG DEF ALL').listen()\r\n        .onChange(function (imgDef) {\r\n          imgDef = DEFAULT === imgDef ? undefined : imgDef;\r\n\r\n          Sun.refreshTextures(imgDef);\r\n          Skymap.setSceneBgCubeTexture(Scene.scene, imgDef);\r\n          Earth.setMaterialTextures(imgDef);\r\n          Cloud.setMaterialTextures(imgDef);\r\n          Moon.setMaterialTextures(imgDef);\r\n        });\r\n\r\n      gui.add(this, 'resetAll').name('RESET ALL');\r\n      gui.add(this, 'help').name('(?) HELP');\r\n    };\r\n\r\n    this.resetAll = function () {\r\n      params.imgDef = DEFAULT;\r\n\r\n      Renderer.gui.reset();\r\n      Scene.gui.reset();\r\n      Camera.gui.reset();\r\n      Skymap.gui.reset();\r\n      Sun.gui.reset();\r\n      Earth.gui.reset();\r\n      Cloud.gui.reset();\r\n      Moon.gui.reset();\r\n      SceneShadow.gui.reset();\r\n    };\r\n\r\n    this.updateAll = function () {\r\n      Camera.updateAspect();\r\n      Renderer.updateSize();\r\n    };\r\n\r\n    this.help = function () {\r\n      var helpElementStyle = document.getElementsByClassName(params.helpClassname)[0].style;\r\n      helpElementStyle.display = this.helpHideToggle(helpElementStyle.display);\r\n    };\r\n\r\n    this.helpHideToggle = function (value) {\r\n      return 'none' === value ? 'block' : 'none';\r\n    };\r\n\r\n    var animate = function () {\r\n      requestAnimationFrame(animate);\r\n\r\n      delta = clock.getDelta();\r\n\r\n      Earth.animate(delta);\r\n      Cloud.animate(delta);\r\n      Moon.animate(delta);\r\n\r\n      Scene.orbitControls.update();\r\n      Renderer.webGLRenderer.render(Scene.scene, Camera.perspectiveCamera);\r\n    };\r\n\r\n    this.init();\r\n  };\r\n\r\n  return new _View();\r\n})();"]}